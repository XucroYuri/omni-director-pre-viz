# 2026 执行路线图（Web First 主线）

## 1. 北极星目标
将 Omni-Director 从单机 Electron 工具演进为可本地运行、可云部署、可团队协作的 Web 平台。

Phase 9 的分阶段细则见：`docs/roadmap/Phase9-Execution-Detail.md`。

核心立足点：
- 应用形态：Next.js 前后端一体（本地与云端同构）。
- 数据层：Postgres（结构化数据）+ 对象存储（媒体文件）。
- 异步层：持久化任务 + worker 自动执行 + 可观测 + 可恢复。
- 协作层：账号、组织、权限、审计、并发编辑。

## 2. 阶段状态快照（截至 2026-02-07）

### 已完成
1. Phase 9.1 基础设施
- `apps/web` 已建立并可本地运行。
- `docker-compose.yml` 已提供 Postgres + MinIO。
- 基础 API（episodes/shots/assets/tasks）已可用。

2. Phase 9.2 核心链路（已落地主干）
- `queued -> running -> completed/failed/cancelled` 状态机可用。
- worker 已接入真实消费、租约、心跳、恢复、退避重试。
- 错误分层统一为 `error_code + message + context`。
- dead-letter 批量重试与审计日志已接入。

### 进行中
1. 9.2.7+ 可观测性与运维面强化
- 指标统一（吞吐、失败率、重试率、dead-letter 增长速度）。
- 审计过滤/导出/清理策略完善。
- 批量重试的安全闸门（限流、dry-run、幂等边界）。

### 待启动
1. Phase 9.3 协作与权限
- 组织/成员/角色（Owner/Editor/Viewer）。
- 项目级权限策略与审计闭环。
- 多用户并发编辑冲突策略。

2. Phase 9.4 迁移与切流
- SQLite -> Postgres 数据迁移与核验报告。
- 云端部署（Vercel）与本地部署并行支持。
- Electron 降级为只读迁移工具或正式退役。

## 3. 执行原则
1. 先打通主链路，再扩功能面：任务执行稳定性优先于 UI 扩张。
2. 删除优先于新增：能通过收敛旧逻辑解决的问题，不新增并行分支。
3. 错误优先结构化：所有失败链路必须可被 `error_code` 归类、统计、重试。
4. 回滚优先设计：每个阶段必须定义可回退策略与触发条件。

## 4. 90 天落地目标（建议）
1. 30 天
- 完成 9.2.7+ 可观测与批量运维闸门。
- 把核心任务链路回归测试自动化（含 dead-letter 批量重试）。

2. 60 天
- 完成 9.3 权限与审计闭环的 MVP。
- 支持至少 2 个账号并行协作同一项目。

3. 90 天
- 完成 9.4 一次真实灰度切流演练。
- 给出 Electron 退役窗口和迁移完成度报告。

## 5. 退出条件（Definition of Done）
满足以下条件后，Web First 可视为主线完成：
1. 核心生产路径（脚本拆解、矩阵生成、任务执行、导出）在 Web 端稳定。
2. 失败任务可定位、可批量处置、可审计复盘。
3. 多用户协作权限正确，越权写入被阻断。
4. 数据迁移可重复执行且可校验。
5. Electron 不再承担主要生产职责。
